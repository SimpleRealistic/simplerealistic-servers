#include <sourcemod>

public Plugin:myinfo =
{
	name = "[CSGO] Server Exploit Fix [5/28/2021]",
	author = "backwards",
	description = "Fixes Server Lag Exploit",
	version = SOURCEMOD_VERSION,
	url = "http://www.steamcommunity.com/id/mypassword"
}

Address:addy = view_as<Address>(0);
Address:addy2 = view_as<Address>(0);

public OnPluginStart()
{
	Address:addy = GameConfGetAddress(LoadGameConfigFile("ExploitFix_5_28_2021"), "Unnamed");
	Address:addy2 = GameConfGetAddress(LoadGameConfigFile("ExploitFix_5_28_2021"), "Unnamed2");

	if(addy != view_as<Address>(0))
	{
		if (GetEngineVersion() == Engine_CSGO)
		{
			new OS = LoadFromAddress(addy + Address:1, NumberType_Int8);
			switch(OS)
			{
				case 0x89: //Linux
				{
					for(int i = 0;i<5;i++)
						StoreToAddress(addy + Address:i + Address:0x31A, 0x90, NumberType_Int8);

					if(addy2 != view_as<Address>(0))
					{
						for(int i = 0;i<5;i++)
							StoreToAddress(addy2 + Address:i + Address:0x34, 0x90, NumberType_Int8);
					}
				} 
				case 0x8B: //Windows
				{
					for(int i = 0;i<6;i++)
						StoreToAddress(addy + Address:i + Address:0x415, 0x90, NumberType_Int8);

					if(addy2 != view_as<Address>(0))
					{
						for(int i = 0;i<6;i++)
							StoreToAddress(addy2 + Address:i + Address:0x48, 0x90, NumberType_Int8);
					}
				}
				default:
				{
					SetFailState("Unnamed Signature Incorrect. (0x%.2x)", OS);
				}
			}
		}
	}
	else
	{
		SetFailState("Unnamed Signature Incorrect (2).");
	}
}