#include <sourcemod>

public Plugin myinfo =
{
    name = "Rcon Exploit Fix",
    author = "backwards",
    description = "Prevents Exploits By Abusing Rcon TCP Connections",
    version = "1.0",
    url = "http://steamcommunity.com/id/mypassword"
};

Address:addy = view_as<Address>(0);
Address:OS = view_as<Address>(0);

public OnPluginStart()
{
	if (GetEngineVersion() != Engine_CSGO)
		SetFailState("This plugin is only for CSGO!");
		
	Address:addy = GameConfGetAddress(LoadGameConfigFile("rcon_exploit"), "RunFrame");

	if(addy != view_as<Address>(0))
	{
		OS = LoadFromAddress(addy + Address:1, NumberType_Int8);
		switch(OS)
		{
			case 0x89: //Linux
			{
				StoreToAddress(addy, 0xC3, NumberType_Int8);
			} 
			case 0x8B: //Windows
			{
				StoreToAddress(addy, 0xC3, NumberType_Int8);
			}
			default:
			{
				SetFailState("RunFrame Signature Incorrect. (0x%.2x)", OS);
			}
		}
	}
	else
	{
		SetFailState("RunFrame Signature Incorrect (2).");
	}
}

public OnPluginEnd()
{
	switch(OS)
	{
		case 0x89: //Linux
		{
			StoreToAddress(addy, 0x55, NumberType_Int8);
		}
		case 0x8B: //Windows
		{
			StoreToAddress(addy, 0x55, NumberType_Int8);
		}
	}
}